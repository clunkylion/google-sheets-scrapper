FROM ghcr.io/puppeteer/puppeteer:22.10.0

USER root

# Crear el directorio si no existe y ajustar permisos
RUN mkdir -p /var/lib/apt/lists/partial && \
    chmod 777 /var/lib/apt/lists/partial

# Instalar dbus, OpenSSL y generar machine-id
RUN apt-get update && \
    apt-get install -y dbus openssl && \
    dbus-uuidgen > /etc/machine-id

ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true \
    PUPPETEER_EXECUTABLE_PATH=/usr/bin/google-chrome-stable \
    CONTABILIUM_URL=https://app.contabilium.cl \
    CONTABILIUM_EMAIL=MARTINRIOJA@GMAIL.COM \
    CONTABILIUM_PASSWORD=APIcontabilum2 \
    EMAIL_USER=scrapper.motoroil@gmail.com \
    EMAIL_PASSWORD="syup eaqu ggpw viyv" \
    TEST_DOCUMENT_ID=1Rn2HBMAlw4C3gGW-5PSn1xdUAr1gYqeC61sFWyuvtqw \
    DOCUMENT_ID=1_IwJEODeSZnu3_ZrZsw6moZBOaAhgwRb92eec5cRh3A \
    GOOGLE_CREDENTIALS=ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiZ2xvYmFsLWFjZS00MjAxMTQiLAogICJwcml2YXRlX2tleV9pZCI6ICJkOWNiMmU3MWJiM2JhN2IwZjRkNmUwZWMyODY2NzBmMDUyODFmNzAwIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUUNhMEVDUFlZTnoyVUFxXG5vcXNXMmlWL1FZM1ZzUmRJNThUckdzWW4zR0d4K2pqR1dzR3lHakFIUU9leTJ3TnBmM21hM1NoNjFPWFJGSlBXXG56b3g3TEVJSFRFQ1BNd2s0bkZzeENRWG5lelkvR1R4TzJUd0g3WTlXQmk1dkkrYi9qVTZrTENqQXF3Y3hnUUFWXG5sWnlDTXdjcUVMWEJzQUFNM3pnYUpVZEVmYXMvQThMcXFUTElyTW5XODVaRW96bmpOQit3eXVxUFRsOWxMSVcxXG52NUFGeHpyUE1qQzlaWWdoTks5bVBuamlzd0JsdkZOVFpvSUF0YmhhVmtabHpIWGJFVldYTVdIQkFWTW4vc1NqXG4yVVk0T3dzUnA0TzB5bDRIbHNyaS9sSXNqMW85Nm9Md05mM0Z0RWUrc0dPK0ZqdWFVOEVUeTJ0Q0t5MDVvSXNjXG5qbEJyWGRhM0FnTUJBQUVDZ2dFQU1FbzJZU01YS0Z0RFh5azNlZHpZNW0xeHl3Nit4eUI0ZGFkMzJQWXV5Ui9XXG5kdFRYWjNFd3V3cDlXM1ppaFpWY1ByaXVpRVlCVzZyeUJJYVFIbG1yVFBCMWtOVm9FbTcvS1BmNkRmOEthRHM4XG5heEhxM2tRMU9pMmFiVk9ER2dLZlhhbGltdHFlVjB3NFZRTkNld0Jrd3pQTUpocjZvUWs5ekRZRm1YRWpxZmRMXG5YV2xoTlNKVEJRdVExblhhdEFaTHhnMWpCU2JRN1pJdFh3WHpvUDNYaE8rdVdiMjJET3F4MmozODgxM2lJTEZuXG5zUkdXR01sdXVoazEyeXdWRHlJQUlraGJFazBvNHgrMzZXT0IvLzR4UGVTNXRrRW5WcEZIQ1B4Uk8rblpLS1hyXG5oSW5FZHpNYXVLQWI3Nzl3WW5oRlJhQkR1VHJHdllHSUQ3WlJOUVY2MVFLQmdRRFdOVnhNNXE0QUxMYlVxaWsrXG5qOGRzMHN5bFFieWV5M0lpY096ZnNuVlB2RDBNRGpDbnh3Vlp2SFNmWERpdDd2WnZaYzlZNzM3a0QrR0lvTjIzXG5hdE1XK0NSdDVHa0lPMFJGcjAzamsyUHZ4UnZKaHVpMDVGdElXWWNESEh2YmoyY2VhNkhtcDFna1N4b1ZGbFprXG5yd3gyRmRqdHVzQ1FndVhNZkVGdm9xbmdtd0tCZ1FDNUJHa3l4R1FDT0YyQlZFT252S0UzVkpJai9EcU1STUk0XG51ZGJvTjB6Z3JUR1p0TFdvbGdrQlBBTzBCdmNVOW9BT3cxcDQ0OVpEeURma2w0R2x3bUwxWUp5RWJLZmhvTnovXG5BMjNSOFFJeDhoWTZ3OUg1ZlAwMm0yNmFSMlVwaURYOGdNRml2Unk2eURBYldjSVVXRjBoUVIwT3c0T1ZVTUlUXG5jbnI5RG5qZUZRS0JnUUNPVXZYNHdteHFBVXVaRVZaR0V4SFY1Rm5FazJEWHdTVWNiUnQxcGdUNzdYNUNQRXRuXG5ybnlIbXdlQnVxeU9KRy9vcENTWVdzaGNqNUN5VHZBQnBpQ0s2bVNKLzNFcDN2Y0Z0ZXh5Z01PdDA3RWF2V0J3XG5rQ2wyY01XYjg1ajMwTmdiQmppVUlDd1lNUzRyUktReVVYeGVHVFlBL2t4anVCVW5RSWZadktKU2NRS0JnQzZsXG5ZUXh1blRRK0Y3MENqS2dlazVyS2xLbkQ3dExzaHZjY1M0VnlZOHlGZmVyZHQ2c1FZS2JTQmJEK3pJNlpjMEhGXG5tT3Evcm9hYVZSVXA2WUxzRmx6OUJaa1JkK1lYMDMvcjBtVksyUjNVaGl3OHNKU3hJWG9DQ0FtWGxIYTdJN2xNXG5rUFVlN3I1Y3VGdzg3Z1NKSHJuQ205dmNDVEc5RWFFcmpMeCtTSlRkQW9HQkFLYi96VGNXOGhXSms5cHJxVnhjXG4vSWVSN0pTbDc1cDh2dGtnMmJaMVJVcWRYWkFtWmZWTFBtSXJRZ3pqTXo3a1ZVSFNMWHlzMVpSVnBpTTQ4S1lDXG45MnUydWw4cU1iTzFqZ1BDdTdDQjJYdUhBdWw4Ykd5V3FhU21KTk1tck9MQmxwY0NPb2FmczNHb0k2SzBTWi9SXG56VnBSU0VXaFhKZ3BsRHIzWnpxNGNoZVNcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJub2RlanMtZ29vZ2xlLXNoZWV0c0BnbG9iYWwtYWNlLTQyMDExNC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMTQyODExNDMwMjA0NDAyOTM4NDkiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L25vZGVqcy1nb29nbGUtc2hlZXRzJTQwZ2xvYmFsLWFjZS00MjAxMTQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJ1bml2ZXJzZV9kb21haW4iOiAiZ29vZ2xlYXBpcy5jb20iCn0K \
    NODE_ENV=PRODUCTION 

EXPOSE 8080    

WORKDIR /usr/src/app


COPY package*.json ./
RUN npm ci
COPY . . 



RUN ls -la /usr/src/app
CMD [ "node", "src/index.js" ]